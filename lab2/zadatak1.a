VJ1      EQU 0FFFF1000

VJ2_REG  EQU 0FFFF2000
VJ2_BS   EQU 0FFFF2004

VJ3_DATA EQU 0FFFF3000
VJ3_IACK EQU 0FFFF3004
VJ3_IEND EQU 0FFFF3008
VJ3_STOP EQU 0FFFF300C

    ORG 0
    MOVE 10000, R7
    JR GLAVNI

    ORG 8
    DW 500

OBRADI
    PUSH R1
    PUSH R2
    LOAD R1, (SP+0C)

    MOVE 1, R2
    SHL R2, R1, R0

    POP R2
    POP R1
    RET

GLAVNI
    MOVE 1, R1
    STORE R1, (VJ3_STOP)
    MOVE %B 10000, SR
CEKAJ
    LOAD R1, (VJ2_BS)
    CMP R1, 1
    JR_NE CEKAJ
SPREMNA
    LOAD R2, (BROJ)
    STORE R2, (VJ2_REG)
    STORE R2, (VJ2_BS)

    LOAD R2, (POSLANO)
    ADD R2, 1, R2
    STORE R2, (POSLANO)
    JR CEKAJ

KRAJ
    HALT

BROJ DW 0
POSLANO DW 0

    ORG 500
    PUSH R0
    PUSH R1
    MOVE SR, R1
    PUSH R1
    STORE R0, (VJ3_IACK)

    LOAD R1, (VJ1)
    CMP R1, 0
    JR_SGE NASTAVI
    MOVE SR, R1
    AND R1, %B 11111111111111111111111111101111, R1
    MOVE R1, SR
    MOVE 0, R1
    STORE R1, (VJ3_STOP)
    JR KRAJ
NASTAVI
    PUSH R1
    CALL OBRADI
    ADD SP, 4, SP

    STORE R0, (BROJ)
    LOAD R1, (POSLANO)
    STORE R1, (VJ3_DATA)

    POP R1
    MOVE R1, SR
    POP R1
    POP R0
    STORE R0, (VJ3_IEND)
    RETI
